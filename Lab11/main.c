/**************************************************************
 * main.c
 * rev 1.0 02-Sep-2021 belsonba
 * Lab11
 * ***********************************************************/

#include "pico/stdlib.h"
#include <stdbool.h>
#include <stdio.h>
#include <assert.h>

#define LOG2VALUES  7
#define NVALUES     (1 << LOG2VALUES)

uint32_t inputs[NVALUES] = {
  2743269382, 1029578282, 3220701523, 252734470, 2626490509, 10567820, 4096329604, 1356428730, 
  622681639, 1308798550, 3594759797, 3775732280, 1604644684, 2562002461, 1814338305, 3516833822,
  1716755530, 2859854176, 2964964568, 368518681, 996394409, 1777946677, 3223104743, 379453096,
  3222919723, 2849657682, 3997385111, 2347558740, 3796917720, 1307189920, 89231531, 1393952757,
  2003938260, 235591507, 2727692367, 2247317982, 1369814852, 292781323, 1989029689, 2874700064,
  1394997063, 3447365477, 2763965733, 3973898667, 423094640, 1262428768, 2122131252, 2891358107,
  2954644925, 1744164597, 2461610342, 1025607218, 3328230673, 574932872, 1669148884, 1325104603,
  1395743173, 643788013, 1784723130, 251543336, 3572319647, 3334068054, 3783320219, 1270947669,
  2792815089, 3573757430, 4147543133, 4213375441, 4237462826, 444597665, 2277458195, 2191829009,
  2532078819, 2177532735, 258330312, 1967009805, 2839136233, 2640944830, 3320558162, 2133431558,
  4006871291, 2426807315, 2810378799, 618408389, 2848104120, 888919531, 1019477753, 3044080789,
  1506610117, 1578087565, 2764515748, 3285527395, 2885734731, 4145415035, 679178318, 3378971566,
  2879158962, 2583993922, 886266367, 2447764386, 3297041484, 1332281221, 2649739510, 2413672741,
  4164466153, 3856463, 652217259, 2698114061, 1532524721, 559882966, 70101186, 3455411626,
  594271320, 1077415817, 823310205, 3920051603, 759724324, 1027144033, 707747736, 3272362022,
  2417644501, 124442174, 3755214983, 4273954329, 2812991507, 4293163982, 1877737150, 2893720993
};
uint32_t average = 2159844058;

extern uint32_t c_average(uint32_t Q, uint32_t* values);
extern uint32_t asm_average(uint32_t Q, uint32_t* values);

int main(void) {
  volatile uint64_t i, repeats;
  volatile uint32_t avg;
  volatile uint64_t span;
  volatile absolute_time_t  from, to;
  
  stdio_init_all();
  printf("CC2511 Lab11\r\n");

  repeats = 1000000;

  uint32_t Q = LOG2VALUES;
  while (true) {
    printf("Answer      = %u\r\n", average);
    from = get_absolute_time();
    for (i = 0; i < repeats; i++) {
      avg = c_average(Q, inputs);
    }
    to = get_absolute_time();
    span = absolute_time_diff_us(from, to);
    printf("c_average   = %u\r\n", avg);
    printf("time (us)   = %llu\r\n", span);

    from = get_absolute_time();
    for (i = 0; i < repeats; i++) {
      avg = asm_average(Q, inputs);
    }
    to = get_absolute_time();
    span = absolute_time_diff_us(from, to);
    printf("asm_average = %u\r\n", avg);
    printf("time (us)   = %llu\r\n", span);

    sleep_ms(1000);
  }
}
